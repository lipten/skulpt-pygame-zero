{"version":3,"sources":["utils.js","main.js"],"names":["loadScript","src","varName","window","Promise","resolve","reject","el","document","createElement","onload","onerror","e","body","removeChild","async","console","log","appendChild","hitTestRectangle","r1","r2","Array","isArray","x","y","width","height","centerX","centerY","halfWidth","halfHeight","vx","vy","combinedHalfWidths","combinedHalfHeights","hit","Math","abs","JsonLoadedMap","textureRecources","resource","loadResource","list","PIXI","utils","TextureCache","loader","add","load","texture","resources","test","fetch","then","res","json","prefix","replace","resoureList","map","item","Sk","defineGetter","func","misceval","callsimOrSuspend","builtins","property","builtin","genkwaFunc","isJsArgs","kwaFunc","kwa","args","kwargs","dict","defineProperty","obj","self","ffi","remapToPy","val","v","libList","PyGameZero","file","promiseToSuspension","resp","result","text","matchModelName","Object","keys","includes","setContainer","container"],"mappings":"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","file":"main.js","sourceRoot":"../src","sourcesContent":["export function loadScript(src, varName){\n  if (window[varName]) {\n    return Promise.resolve(window[varName]);\n  }\n  const res = new Promise(function(resolve, reject) {\n    const el = document.createElement('script');\n    el.onload = function() {\n      resolve(varName && window.varName);\n    };\n\n    el.onerror = function(e) {\n      el.onload = null;\n      el.onerror = null;\n      document.body.removeChild(el);\n      reject(e);\n    };\n    el.src = src;\n    el.async = true;\n    console.log(document.body)\n    document.body.appendChild(el);\n  });\n  return res;\n}\n\n\n// 碰撞检测函数\nexport function hitTestRectangle(r1, r2) {\n  // 如果r2是坐标点\n  if (Array.isArray(r2)) {\n    r2.x = r2[0];\n    r2.y = r2[1];\n    r2.width = 0;\n    r2.height = 0;\n  }\n\n  //Define the variables we'll need to calculate\n  let hit;\n\n  //hit will determine whether there's a collision\n  hit = false;\n\n  //Find the center points of each sprite\n  r1.centerX = r1.x + r1.width / 2;\n  r1.centerY = r1.y + r1.height / 2;\n  r2.centerX = r2.x + r2.width / 2;\n  r2.centerY = r2.y + r2.height / 2;\n\n  //Find the half-widths and half-heights of each sprite\n  r1.halfWidth = r1.width / 2;\n  r1.halfHeight = r1.height / 2;\n  r2.halfWidth = r2.width / 2;\n  r2.halfHeight = r2.height / 2;\n\n  //Calculate the distance vector between the sprites\n  const vx = r1.centerX - r2.centerX;\n  const vy = r1.centerY - r2.centerY;\n\n  //Figure out the combined half-widths and half-heights\n  const combinedHalfWidths = r1.halfWidth + r2.halfWidth;\n  const combinedHalfHeights = r1.halfHeight + r2.halfHeight;\n\n  //Check for a collision on the x axis\n  if (Math.abs(vx) < combinedHalfWidths) {\n\n    //A collision might be occuring. Check for a collision on the y axis\n    if (Math.abs(vy) < combinedHalfHeights) {\n\n      //There's definitely a collision happening\n      hit = true;\n    } else {\n\n      //There's no collision on the y axis\n      hit = false;\n    }\n  } else {\n\n    //There's no collision on the x axis\n    hit = false;\n  }\n\n  //`hit` will be either `true` or `false`\n  return hit;\n}\n\n// 加载纹理\nconst JsonLoadedMap = {};\nexport function textureRecources (resource) {\n  function loadResource(resource) {\n    let list;\n    if (Array.isArray(resource)) {\n      list = [...resource];\n      resource = list[0]\n    }\n    return new Promise((resolve, reject) => {\n      if (window.PIXI.utils.TextureCache[resource]) {\n        resolve(window.PIXI.utils.TextureCache[resource])\n      } else {\n        console.log(list || resource)\n        window.PIXI.loader.add(list || resource).load(function() {\n          const texture = window.PIXI.loader.resources[resource].texture;\n          resolve(texture)\n        });\n      }\n    })\n  }\n  if (/\\.json$/.test(resource)) {\n    if (JsonLoadedMap[resource]) {\n      return loadResource(JsonLoadedMap[resource])\n    } else {\n      return fetch(resource).then((res) => {\n        return res.json()\n      }).then((res) => {\n        const prefix = resource.replace('index.json', '');\n        const resoureList = res.map((item) => {\n          return prefix + item\n        })\n        JsonLoadedMap[resource] = resoureList;\n        return loadResource(resoureList)\n      })\n    }\n  } else {\n    return loadResource(resource)\n  }\n}\nconst Sk = window.Sk;\n// getter函数\nexport const defineGetter = function(func) {\n  return Sk.misceval.callsimOrSuspend(Sk.builtins.property, new Sk.builtin.func(func), new Sk.builtin.func(function() {}));\n}\n// 生成kwargs函数\nexport function genkwaFunc(func, isJsArgs) {\n  const kwaFunc = function(kwa, ...args){\n    if (!isJsArgs) {\n      args = new Sk.builtins['tuple'](args); /*vararg*/\n    }\n    const kwargs = new Sk.builtin.dict(kwa);\n    return func(args, kwargs)\n  }\n  kwaFunc['co_kwargs'] = true;\n  return kwaFunc;\n}\n// 监听属性getter/setter\nexport const defineProperty = function(obj, property) {\n  return Sk.misceval.callsimOrSuspend(Sk.builtins.property, new Sk.builtin.func(function(self) {\n    if (typeof obj === 'function') {\n      return obj(self)\n    } else {\n      return Sk.ffi.remapToPy(self[obj][property])\n    }\n  }), new Sk.builtin.func(function(self, val) {\n    if (typeof property === 'function') {\n      property(self, val)\n    } else {\n      self[obj][property] = val.v;\n    }\n  }))\n}\n  \n\n","import {loadScript} from './utils'\nconst Sk = window.Sk;\nconst libList = {\n  \"./pgzrun/__init__.js\": \"./dist/pygame-zero.js\",\n  // \"./pgzrun/__init__.js\": \"https://cdn.jsdelivr.net/gh/lipten/skulpt-pygame-zero/dist/pygame-zero.js\",\n}\nexport const PyGameZero = {\n  load: function(file) {\n    return Sk.misceval.promiseToSuspension(\n      new Promise((resolve, reject) => {\n        loadScript('https://cdn.bootcdn.net/ajax/libs/pixi.js/5.3.4/pixi.min.js', 'PIXI').then(() => {\n          fetch(libList[file]).then(\n            function (resp){ \n              const result = resp.text();\n              resolve(result); \n            }\n          )\n        })\n      }))\n  },\n  matchModelName: function(file) {\n    return Object.keys(libList).includes(file);\n  },\n  setContainer: function(el) {\n    this.container = el;\n  },\n}\nwindow.PyGameZero = PyGameZero"]}